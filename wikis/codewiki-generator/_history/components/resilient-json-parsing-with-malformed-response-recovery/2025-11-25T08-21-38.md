---
title: Resilient JSON parsing with malformed response recovery
category: component
sourceFile: lib/agents/guide-generation-agent.js
related: []
created: 2025-11-25
updated: 2025-11-25
---

# Resilient JSON parsing with malformed response recovery

## Purpose and Overview

This component implements a robust multi-stage error recovery strategy for parsing JSON responses from Claude AI that may be malformed or wrapped in extraneous content. It addresses the common production issue where LLM outputs don't always conform to expected JSON formats, providing critical resilience for guide generation workflows.

## Key Functionality

The resilient JSON parser operates through multiple recovery stages:

- **Content Extraction**: Identifies and extracts JSON content from responses that may contain extra text, markdown formatting, or wrapper content
- **Validation Testing**: Attempts standard JSON parsing first, then progressively applies recovery techniques
- **Heuristic Repairs**: Implements pattern-based fixes for common JSON malformation issues such as:
  - Missing closing brackets or braces
  - Trailing commas
  - Unescaped quotes
  - Incomplete nested structures
- **Fallback Handling**: Provides graceful degradation when all recovery attempts fail

The parser processes responses in order of likelihood, starting with standard parsing and escalating through increasingly aggressive repair strategies until valid JSON is recovered or all options are exhausted.

## Relationships

This component is integrated within the guide generation agent and serves as a critical middleware layer between:

- **Claude AI API responses** - Raw text responses that may contain malformed JSON
- **Guide generation pipeline** - Downstream processes that require valid JSON data structures
- **Error handling system** - Feeds into broader error recovery and logging mechanisms

The parser acts as a reliability gateway, ensuring that guide generation workflows can continue even when AI responses are imperfectly formatted.

## Usage Example

```javascript
// Component is integrated within guide-generation-agent.js
// Handles JSON parsing automatically during guide generation
const response = await claudeApiCall(prompt);
const parsedData = resilientJsonParse(response); // Multi-stage recovery applied
const guide = processGuideData(parsedData);
```

## Testing

No automated tests found. Consider adding test coverage for various malformed JSON scenarios and recovery patterns.