---
title: Express Server with Middleware Pipeline
category: component
sourceFile: server.js
related: [_history/_history/components/express-server-with-middleware-pipeline/2025-11-24T14-38-56/2025-11-24T14-38-58.md]
created: 2025-11-24
updated: 2025-11-24
---

# [Express Server with Middleware Pipeline](../_history/_history/components/express-server-with-middleware-pipeline/2025-11-24T14-38-56/2025-11-24T14-38-58.md)

## Purpose and Overview

The Express server (`server.js`) establishes the HTTP server foundation for the dashboard application, configuring a complete middleware pipeline for request handling, error management, and graceful shutdown. It serves as the critical infrastructure that powers the application, handling everything from route definition to production-ready error recovery and orchestration signals.

## Key Functionality

### Server Initialization
- **Port Configuration**: Dynamically selects the server port from environment variables with a fallback to port 3000
- **Environment Awareness**: Adapts behavior based on `NODE_ENV` (development, test, production), controlling error verbosity and startup behavior
- **View Engine Setup**: Configures EJS templating for rendering dynamic views

### Middleware Pipeline
The server implements a layered middleware architecture:

1. **Static File Serving**: Serves assets from the `/public` directory
2. **View Engine Integration**: Enables server-side rendering with EJS templates
3. **Request Processing**: Routes requests through the configured application handlers
4. **Error Handling**: Global error middleware with environment-aware response details

### [Health Check and Observability](../components/health-check-and-observability.md)
- **`/health` Endpoint**: GET endpoint returning server status, timestamp, and version metadata
- **Monitoring Support**: Enables external systems to verify service availability and readiness

### [Graceful Shutdown Pattern](../concepts/graceful-shutdown-pattern.md)
- **SIGTERM Handler**: Listens for termination signals to cleanly close server connections before process exit
- **Resource Safety**: Prevents resource leaks and ensures safe deployment transitions during scaling or updates

### Error Handling
- **404 Handler**: Catches undefined routes and returns structured error responses
- **Global Error Middleware**: Logs errors and returns HTTP 500 responses with appropriate detail levels based on environment

## Relationships

- **Module Export**: Exports the `app` module for use in testing frameworks and external initialization
- **Dependencies**: 
  - Requires `dotenv` for environment variable configuration
  - Uses EJS templating engine for view rendering
  - Expects `/views` and `/public` directories for templates and static assets
- **Integration Point**: Serves as the entry point for all HTTP request handling in the application

## Usage Example

```javascript
const app = require('./server');

// Server initializes automatically when imported
// PORT is read from environment variables or defaults to 3000
// Health check available at: GET http://localhost:3000/health

// Response example from /health endpoint:
// {
//   status: 'ok',
//   timestamp: '2024-01-15T10:30:00Z',
//   version: '1.0.0'
// }

// Graceful shutdown triggered by SIGTERM signal
// Process will cleanly close connections before terminating
```

## Testing

The Express server is covered by comprehensive integration tests located in `tests/integration/server.test.js`:

- **11 test cases** across **6 test suites**
- **Coverage areas**:
  - Express Server initialization and configuration
  - Health Check endpoint functionality
  - Static file serving from `/public`
  - View engine rendering capabilities
  - Error handling (404 and 500 responses)
  - Middleware pipeline configuration

Tests verify that the server correctly initializes with environment variables, serves static assets, renders views, handles errors appropriately, and maintains the configured middleware stack.