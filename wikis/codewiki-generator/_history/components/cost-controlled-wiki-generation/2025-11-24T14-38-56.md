---
title: Cost-controlled wiki generation
category: component
sourceFile: generate-self-wiki.js
related: [_history/_history/components/cost-controlled-wiki-generation/2025-11-24T14-38-56/2025-11-24T14-38-58.md]
created: 2025-11-24
updated: 2025-11-24
---

# [Cost-controlled Wiki Generation](../_history/_history/components/cost-controlled-wiki-generation/2025-11-24T14-38-56/2025-11-24T14-38-58.md)

## Purpose and Overview

The `generate-self-wiki.js` script enables repositories to automatically generate their own wiki documentation from local git history, eliminating the need for GitHub API calls and associated costs. This implements a [self-documenting repository pattern](../concepts/self-documenting-repository-pattern.md) where documentation stays synchronized with code changes through regular script execution, while maintaining strict cost controls to prevent API expense overruns.

## Key Functionality

This script extracts documentation data directly from your local git repository and feeds it into the existing wiki generation pipeline:

- **Local Git History Extraction**: Retrieves recent commits with full file changes and diffs using the `getLocalCommits()` function, which executes git CLI commands to access repository history without external API calls
- **Cost-Controlled Processing**: Enforces configurable spending limits (default $1.00 maximum cost) and meta-analysis frequency settings to prevent runaway API usage during wiki generation
- **GitHub Client Mocking**: Injects local commit data into the standard `Processor` class workflow by mocking the GitHub client interface, allowing reuse of existing documentation generation logic
- **Wiki Output**: Generates markdown documentation files to the `./wiki/` directory for version control inclusion

The script orchestrates the entire process through its `main()` function, which coordinates data extraction and processing while respecting defined cost constraints.

## Relationships

- **Depends on**: `Processor` class from `./lib/processor` for core wiki generation logic
- **Integrates with**: Git CLI via `execSync` to access repository history without GitHub API dependencies
- **Outputs to**: `./wiki/` directory for inclusion in version control
- **Pattern**: Mocks GitHub client interface to inject local data into the standard Processor workflow, enabling offline documentation generation

## Usage Example

```javascript
const { main } = require('./generate-self-wiki');

// Execute wiki generation from local git history
// Automatically respects cost limits and generates wiki files
main().catch(error => {
  console.error('Wiki generation failed:', error);
  process.exit(1);
});
```

To run the script as part of your repository maintenance:

```bash
node generate-self-wiki.js
```

This generates documentation from recent local commits and outputs it to the `./wiki/` directory. You can integrate this into your CI/CD pipeline or run manually before committing documentation updates.

## Configuration

Adjust cost controls by modifying the parameters passed to the Processor:

- **maxCost**: Maximum API spend limit (default: $1.00) - set lower values for tighter cost control
- **metaAnalysisFrequency**: How often to analyze commits for documentation patterns - higher values reduce API calls but may decrease documentation quality

## Testing

No automated tests are currently available. Test this script by:

1. Running it locally on a repository with recent commit history
2. Verifying the generated wiki files in `./wiki/` directory
3. Monitoring cost output to ensure it stays within configured limits
4. Reviewing generated documentation for accuracy and completeness