---
title: Repository-scale batch processing with resumable state
category: concept
sourceFile: lib/processor.js
related: []
created: 2025-11-25
updated: 2025-11-25
---

# Repository-scale Batch Processing with Resumable State

## Purpose and Overview

The Processor component implements an architectural pattern for processing entire repositories commit-by-commit with persistent state management. It enables resumable processing across sessions and provides fault tolerance for large-scale repository analysis operations.

## Key Functionality

### Core Processing Features
- **Commit-by-commit processing**: Iterates through repository history to analyze code changes incrementally
- **Resumable state management**: Maintains processing state across sessions, allowing operations to resume from the last processed commit
- **Cost-aware API consumption**: Tracks and enforces configurable cost budgets, pausing processing when limits are reached
- **Periodic meta-analysis**: Integrates high-level analysis agents that review accumulated progress data at configurable intervals

### Processing Pipeline
- Fetches commit history from GitHub repositories
- Determines significant files for analysis based on configurable criteria
- Retrieves relevant context from existing documentation
- Processes commits through multiple specialized agents (code analysis, documentation, tech debt, security)
- Updates wiki pages with generated documentation and analysis results
- Maintains cumulative cost tracking across all API operations

## Relationships

### Dependencies
- **GitHubClient**: Parses repository URLs and fetches commit history
- **ClaudeClient**: Monitors cumulative API costs across processing sessions
- **WikiManager**: Manages documentation page creation and updates
- **StateManager**: Handles persistent state for resumable processing
- **MetaAnalysisAgent**: Provides periodic high-level insights during batch processing

### Agent Integration
Works with multiple specialized agents:
- Code analysis agents for extracting concepts and components
- Documentation writer agents for generating wiki content
- Tech debt agents for identifying maintenance issues
- Security agents for vulnerability assessment

## Usage Example

```javascript
describe('Processor', () => {
  let processor;
  let mockWikiManager;
  let mockStateManager;
  let mockCodeAnalysisAgent;
  let mockDocWriterAgent;
  let mockTechDebtAgent;
  let mockSecurityAgent;

  beforeEach(() => {
    // Create mock managers and agents
    mockWikiManager = {
      getPage: jest.fn(),
      createPage: jest.fn(),
      updatePage: jest.fn(),
      searchPages: jest.fn(),
      getRelatedPages: jest.fn(),
      updatePageGlobalMetadata: jest.fn()
    };

    mockStateManager = {
      loadState: jest.fn()
      // Additional state management methods...
    };
    
    // Initialize processor with dependencies
    processor = new Processor({
      wikiManager: mockWikiManager,
      stateManager: mockStateManager,
      agents: {
        codeAnalysis: mockCodeAnalysisAgent,
        docWriter: mockDocWriterAgent,
        techDebt: mockTechDebtAgent,
        security: mockSecurityAgent
      }
    });
  });
```

## Testing

**Test Coverage**: `tests/unit/processor.test.js`
- 26 test cases across 6 test suites
- Test categories include:
  - Core Processor functionality
  - Commit processing (`processCommit`)
  - File significance determination (`isSignificantFile`)
  - Context retrieval (`getRelevantContext`)
  - Page path determination (`determinePagePath`)
  - Repository processing (`processRepository`)